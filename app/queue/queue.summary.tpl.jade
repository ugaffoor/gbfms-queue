.panel.panel-primary
  .panel-heading
    h5.panel-title {{vm.item.label}} 
      span.fa.fa-fw.fa-spin.fa-circle-o-notch.pull-right(data-ng-if="vm.isLoading")
  .panel-body
    .row
      .col-xs-6
        span.fa.fa-fw.fa-flag
        | &nbsp;{{queue.friendlyStatus(vm.item)}}
      .col-xs-6
        .ellipsis(data-ng-if="!vm.isAssigningGroup")
          span.fa.fa-fw.fa-users
          | &nbsp;
          a(data-ng-if="details.isOpen(vm.item)",href="",data-ng-click="vm.startGroupAssignment()") {{queue.friendlyAssignedGroup(vm.item)}}
          span(data-ng-if="!details.isOpen(vm.item)") {{queue.friendlyAssignedGroup(vm.item)}}
        .selection(data-ng-if="vm.isAssigningGroup")
          a(href="",data-ng-click="vm.stopGroupAssignment()") Cancel
          input.form-control#group-selector(
            type="text",ng-model="selected",
            uib-typeahead="group.label for group in vm.allGroups | filter:$viewValue | limitTo:8",
            typeahead-min-length="0",
            typeahead-editable="false",
            typeahead-on-select="vm.groupSelected($item)",
            data-ng-disabled="vm.isLoading")
    .row
      .col-xs-6
        span.fa.fa-fw.fa-clock-o
        | &nbsp;
        span(data-time-ago="queue.friendlyDueDate(vm.item)",data-ng-class="{'text-danger': queue.isOverdue(queue.friendlyDueDate(vm.item))}")
      .col-xs-6
        .ellipsis(data-ng-if="!vm.isAssigningMember")
          span.fa.fa-fw.fa-user
          | &nbsp;
          a(data-ng-if="details.isOpen(vm.item)",href="",data-ng-click="vm.startMemberAssignment()") {{queue.friendlyAssignedName(vm.item)}}
          span(data-ng-if="!details.isOpen(vm.item)") {{queue.friendlyAssignedName(vm.item)}}
        .selection(data-ng-if="vm.isAssigningMember")
          a(href="",data-ng-click="vm.stopMemberAssignment()") Cancel
          input.form-control#member-selector(
            type="text",
            data-ng-model="selected",
            uib-typeahead="member for member in vm.membersForGroup | filter: $viewValue | limitTo:8",
            typeahead-min-length="0",
            typeahead-editable="false",
            typeahead-on-select="vm.memberSelected($item)",
            data-ng-disabled="vm.isLoading")
    .row
      .col-xs-6
        span.fa.fa-fw.fa-calendar
        | &nbsp;
        span(data-time-ago="vm.item.createdAt",time-ago-prefix="Created")
      .col-xs-6
        span.fa.fa-fw.fa-calendar
        | &nbsp;
        span(data-time-ago="vm.item.updatedAt",time-ago-prefix="Updated")
      .col-xs-12
        .well-details {{queue.friendlySummary(vm.item)}}
    .row(data-ng-if="queue.hasDetails(vm.item)")
      .col-xs-12
        .well.well-details {{queue.friendlyDetails(vm.item)}}
    .row(data-ng-if="!details.isMine()")
      .col-xs-12
        button.btn.btn-primary.btn-block(data-ng-click="vm.grabIt()") Grab It
    .row(data-ng-if="details.isMine()")
      .col-xs-6(data-ng-if="vm.inWorkOrReview() && !vm.inSubtask()")
        button.btn.btn-primary.btn-block(type="button",data-ui-sref="queue.by.details.summary")
          div(data-ng-if="!details.isOpen()") Stop Reviewing It
          div(data-ng-if="details.isOpen()") Stop Working It
      .col-xs-6(data-ng-if="!vm.inWorkOrReview() && !vm.inSubtask()")
        button.btn.btn-primary.btn-block(data-ui-sref="queue.by.details.summary.work")
          div(data-ng-if="!details.isOpen()") Review It
          div(data-ng-if="details.isOpen()") Work It
      .col-xs-3.col-xs-offset-9(data-ng-if="!vm.inWorkOrReview() && vm.inSubtask()")
        button.btn.btn-warning.btn-block(type="button",data-ui-sref="queue.by.details.summary") Stop
      .col-xs-3.col-xs-offset-3(data-ng-if="!vm.inWorkOrReview() && !vm.inSubtask() && details.canHaveSubtasks()")
        //button.btn.btn-warning.btn-block(data-ng-if="details.isOpen() && details.canHaveSubtasks()",data-ui-sref="queue.by.details.summary.task") Add
        div(uib-dropdown="",data-ng-if="!vm.inSubtask()")
          button.btn.btn-warning.btn-block.dropdown-toggle#subtasks(type="button",uib-dropdown-toggle="") 
            | Add&nbsp;
            span.caret
          ul.dropdown-menu.dropdown-menu-right.dropdown-mobile(uib-dropdown-menu="",role="menu",aria-labelledby="subtasks")
            li(role="menuitem",data-ng-repeat="task in vm.subtasks")
              a(data-ui-sref="queue.by.details.summary.task({subtaskSlug: task.slug})") {{task.name}}
        //button.btn.btn-default.pull-right(data-ng-if="details.isOpen() && details.canHaveSubtasks()",data-ng-click="vm.toggleAddingSubtask()",uib-tooltip="{{vm.addingTask ? 'Stop choosing a task to create.' : 'Choose a task to create.'}}") 
          span.fa.fa-fw.fa-plus(data-ng-if="!vm.addingSubtask")
          span.fa.fa-fw.fa-times-circle-o(data-ng-if="vm.addingSubtask")
    //.row(data-ng-if="vm.addingSubtask")
      .col-xs-12
        .panel.panel-primary.row-cards
          .panel-body
            script(type="text/ng-template" id="subtask-template.html")
              a
                div(ng-bind-html="match.label | uibTypeaheadHighlight:query")
                small(data-ng-if="match.model.description") {{match.model.description}}
            div(data-ng-if="!vm.selectedSubtask")
              label(for="task-selector") Select Task:
              input.form-control#task-selector(
                type="text",
                data-ng-model="selected",
                uib-typeahead="task.name for task in vm.subtasks | filter: $viewValue | limitTo:8",
                typeahead-min-length="0",
                typeahead-editable="false",
                typeahead-on-select="vm.selectSubtask($item)",
                typeahead-template-url="subtask-template.html"
                )
//.row(data-ng-if="details.isMine()")
  div(data-ng-class="{'col-xs-6': details.isOpen(), 'col-xs-12': !details.isOpen()}")
    button.btn.btn-primary.btn-block(data-ui-sref="queue.by.details.summary.work")
      div(data-ng-if="!details.isOpen()") Review It
      div(data-ng-if="details.isOpen()") Work It
  .col-xs-6
    button.btn.btn-warning.btn-block(data-ng-if="details.isOpen() && details.canHaveSubtasks()",data-ui-sref="queue.by.details.summary.task") Add Task
//.row(data-ng-if="details.isMine()")
  div(data-ng-class="{'col-xs-6': details.isOpen(), 'col-xs-12': !details.isOpen()}")
    button.btn.btn-primary.btn-block(data-ng-click="vm.toggleWorkingIt()")
      div(data-ng-if="vm.workingIt && details.isOpen()") Stop Working It
      div(data-ng-if="vm.workingIt && !details.isOpen()") Stop Reviewing It
      div(data-ng-if="!vm.workingIt && !details.isOpen()") Review It
      div(data-ng-if="!vm.workingIt && details.isOpen()") Work It
  .col-xs-6
    button.btn.btn-warning.btn-block(data-ng-if="details.isOpen() && details.canHaveSubtasks()",data-ng-click="vm.toggleAddingSubtask()") 
      span(data-ng-if="!vm.addingSubtask") Add Task
      span(data-ng-if="vm.addingSubtask") Cancel Adding Task
.row
  .col-xs-12
    div(data-ui-view="")
.row.row-cards(data-ng-if="vm.item.parent")
  .col-xs-12
    h5.item-header Created From
    .panel.panel-card(data-ui-sref="queue.by.details.summary({itemId: vm.item.parent.id})")
      h5 {{vm.item.parent.label}}
      .row
        .col-xs-6
          span.fa.fa-fw.fa-flag
          | &nbsp;{{queue.friendlyStatus(vm.item.parent)}}
        .col-xs-6
          .ellipsis
            span.fa.fa-fw.fa-users
            | &nbsp;{{queue.friendlyAssignedGroup(vm.item.parent)}}
      .row
        .col-xs-6
          span.fa.fa-fw.fa-calendar
          | &nbsp;
          span(data-time-ago="queue.friendlyDueDate(vm.item.parent)",data-ng-class="{'text-danger': queue.isOverdue(queue.friendlyDueDate(vm.item.parent))}")
        .col-xs-6
          .ellipsis
            span.fa.fa-fw.fa-user
            | &nbsp;{{queue.friendlyAssignedName(vm.item.parent)}}
      .row
        .col-xs-12
          p.well-details {{queue.friendlySummary(vm.item.parent)}}
.row.row-cards
  .col-xs-12
    h5.item-header Related Items
    .row(data-ng-repeat="child in vm.item.children",data-ui-sref="queue.by.details.summary({itemId: child.id})")
      .col-xs-12
        .panel.panel-card
          h5 {{child.label}}
          .row
            .col-xs-6
              span.fa.fa-fw.fa-flag
              | &nbsp;{{queue.friendlyStatus(child)}}
            .col-xs-6
              .ellipsis
                span.fa.fa-fw.fa-users
                | &nbsp;{{queue.friendlyAssignedGroup(child)}}
          .row
            .col-xs-6
              span.fa.fa-fw.fa-calendar
              | &nbsp;
              span(data-time-ago="queue.friendlyDueDate(child)",data-ng-class="{'text-danger': queue.isOverdue(queue.friendlyDueDate(child))}")
            .col-xs-6
              .ellipsis
                span.fa.fa-fw.fa-user
                | &nbsp;{{queue.friendlyAssignedName(child)}}
          .row
            .col-xs-12
              p.well-details {{queue.friendlySummary(child)}}